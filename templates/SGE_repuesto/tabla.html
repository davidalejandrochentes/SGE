{% extends "layout/base.html" %}

{% block 'title'%} Detalles de la Máquina {% endblock %}

{% block 'search' %}
<form class="d-flex form-inline mr-auto ml-md-3 my-2 my-md-0 ms-3 me-3 mw-100 navbar-search" role="search" action="" method='GET'>
    <div class="input-group">
        <input class="form-control bg-light border-0 small" id="search-input" name="search" type="search" placeholder="Search" aria-label="Search">
        <div class="input-group-append">
            <button class="btn barra text-light" type="submit">
                <i class="bi bi-search"></i>
            </button>
        </div>
    </div>
</form>
{% endblock 'search' %}

{% block 'content' %}

<div class="container">

    <div class="d-flex p-3 justify-content-between">
        <a class="text-decoration-none text-dark flecha-atras" href="{% url "repuesto_maquina" %}">
            <i class="bi bi-arrow-left fs-1"></i>
        </a> 
        <div class="pt-2 me-3 me-md-0">
            <button type="button" class="btn btn-success" onclick="location.href='{% url 'descargar_excel_general' %}'">
                Descargar <i class="bi bi-box-arrow-down"></i>
            </button>  
        </div>
    </div>

    <div class="mt-3 ps-5 pe-5">
        
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Maquina</th>
                    <th>Parte de la máquina</th>
                    <th>Tipo</th>
                    <th>Rosca</th>
                    <th>Largo</th>
                    <th>Und</th>
                    <th>Cantidad necesaria</th>
                    <th>Existencia en stock</th>
                    <th>Salida</th>
                    <th>Existencia física</th>
                </tr>
            </thead>
            <tbody>
                {% regroup inventarios by parte.maquina.nombre as maquina_list %}
                {% for maquina in maquina_list %}
                    <tr>
                        <td rowspan="{{ maquina.list|length }}">{{ maquina.grouper }}</td>
                        {% for inventario in maquina.list %}  
                            <td>{{ inventario.parte.nombre }}</td>
                            <td>{{ inventario.tipo }}</td>
                            <td>{{ inventario.rosca }}</td>
                            <td>{{ inventario.largo }}</td>
                            <td>{{ inventario.und }}</td>
                            <td>{{ inventario.cantidad_necesaria }}</td>
                            <td>{{ inventario.existencia_stock }}</td>
                            <td>{{ inventario.salida }}</td>
                            <td>{{ inventario.existencia_fisica }}</td>
                        </tr>
                        {% endfor %}
                {% endfor %}
            </tbody>
        </table>

    </div>

</div>

{% endblock %}